<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" type="image/png" href="/favicon.png">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E2E Test Plan - Slate Systems</title>
    <style>
        :root {
            --navy: #152a45;
            --gray: #525c69;
            --orange: #ee7000;
            --white: #ffffff;
            --dark-bg: #0d1a2d;
            --card-bg: #1a2d47;
            --border: #2a4060;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--dark-bg);
            color: var(--white);
            line-height: 1.6;
        }
        .top-nav {
            background: var(--navy);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 2px solid var(--orange);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: none;
        }
        .top-nav::-webkit-scrollbar { display: none; }
        .nav-container {
            display: flex;
            align-items: center;
            min-width: max-content;
            padding: 0 1rem;
            gap: 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        .nav-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-shrink: 0;
            padding: 0.6rem 0;
        }
        .nav-logo { height: 28px; width: auto; }
        .nav-subtitle {
            background: var(--orange);
            color: var(--white);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 700;
            letter-spacing: 0.5px;
        }
        .nav-links { display: flex; gap: 0; }
        .nav-link {
            color: var(--white);
            text-decoration: none;
            padding: 0.75rem 0.9rem;
            font-size: 0.8rem;
            white-space: nowrap;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.2s;
            opacity: 0.7;
        }
        .nav-link:hover { opacity: 1; background: rgba(255,255,255,0.05); }
        .nav-link.active { opacity: 1; border-bottom-color: var(--orange); }
        .main { max-width: 1200px; margin: 0 auto; padding: 1.5rem 1rem; }
        .back-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--orange);
            text-decoration: none;
            font-size: 0.85rem;
            margin-bottom: 1rem;
        }
        .back-link:hover { text-decoration: underline; }
        h1 { font-size: 1.75rem; margin-bottom: 0.5rem; }
        .meta { color: var(--gray); font-size: 0.85rem; margin-bottom: 1.5rem; }
        .section { margin-bottom: 2rem; }
        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--orange);
        }
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }
        .card-title {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 0.5rem;
            color: var(--orange);
        }
        .flow-box {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .flow-box pre {
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.65rem;
            line-height: 1.4;
            white-space: pre;
            color: #a0aec0;
        }
        @media (min-width: 768px) {
            .flow-box pre { font-size: 0.75rem; }
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
        }
        th {
            background: var(--navy);
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
        }
        tr:last-child td { border-bottom: none; }
        .badge {
            display: inline-block;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.65rem;
            font-weight: 600;
        }
        .badge-ready { background: #22c55e; color: white; }
        .badge-progress { background: #eab308; color: black; }
        .badge-passed { background: #22c55e; color: white; }
        .badge-fixed { background: #3b82f6; color: white; }
        code {
            background: var(--dark-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 0.8rem;
        }
        .code-block {
            background: var(--dark-bg);
            padding: 1rem;
            border-radius: 6px;
            overflow-x: auto;
            margin: 0.5rem 0;
        }
        .code-block code {
            background: none;
            padding: 0;
        }
        ul, ol { margin-left: 1.5rem; margin-bottom: 1rem; }
        li { margin-bottom: 0.25rem; font-size: 0.9rem; }
        footer {
            text-align: center;
            padding: 1.5rem;
            color: var(--gray);
            font-size: 0.8rem;
            border-top: 1px solid var(--border);
        }
    </style>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="assets/Slate_Systems_Logo_White.png" alt="Slate Systems" class="nav-logo">
                <span class="nav-subtitle">ADMIN</span>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Dashboard</a>
                <a href="index.html#journey" class="nav-link">Journey</a>
                <a href="index.html#portals" class="nav-link">Portals</a>
                <a href="index.html#agents" class="nav-link">AI Agents</a>
                <a href="index.html#sops" class="nav-link">All SOPs</a>
                <a href="glossary.html" class="nav-link">Glossary</a>
            </div>
        </div>
    </nav>

    <main class="main">
        <a href="index.html" class="back-link">< Back to Admin</a>

        <h1>Content Generator - E2E Test Plan</h1>
        <p class="meta">Status: <span class="badge badge-ready">READY FOR TESTING</span> | Last Updated: Feb 13, 2026</p>

        <!-- System Overview -->
        <section class="section">
            <h2 class="section-title">System Overview</h2>

            <div class="card">
                <div class="card-title">Workflows</div>
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Purpose</th>
                            <th>Trigger</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>dGQwIMyZImbYwucC</code></td>
                            <td>Content Generator</td>
                            <td>Save onboarding + scrape website</td>
                            <td>GHL Form Submit</td>
                        </tr>
                        <tr>
                            <td><code>4BaNEGdjuP5EsLUy</code></td>
                            <td>Build Notes Trigger</td>
                            <td>Generate content + push to GHL</td>
                            <td>GHL Form Submit</td>
                        </tr>
                        <tr>
                            <td><code>WrMcZYiQtYHXi9yG</code></td>
                            <td>Image Uploader</td>
                            <td>Convert HTTP to HTTPS images</td>
                            <td>Called by Build Notes</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="flow-box">
                <pre>
WORKFLOW 1: Content Generator (dGQwIMyZImbYwucC)
[GHL Onboarding Form] -> Webhook -> Parse Form -> Log to Baserow
                                                        |
                                            Scrape Client Website
                                                        |
                                            Save Scraped Data -> Respond
                                                        |
                                            Status: awaiting_notes
                                                    |
                                        [GHL Build Notes Form]
                                                    |
WORKFLOW 2: Build Notes Trigger (4BaNEGdjuP5EsLUy)
Webhook -> Parse Build Notes -> Fetch Onboarding Data -> Prepare Agent Prompt
                                                                |
    Call OpenClaw Agent -> Process Response -> Search Images (v5.3)
                                                        |
                                        Upload Images to GHL (Workflow 3)
                                                        |
                                        Update GHL Values (v2.8)
                                                        |
                                        Update Baserow -> Send Email -> Respond

WORKFLOW 3: Image Uploader to GHL (WrMcZYiQtYHXi9yG)
Webhook -> Prepare Images -> Loop Images -> Download -> Upload to GHL
                                    |
                            Collect Results -> Respond
                                    |
                    Returns: {url_mapping: {key: https_url}}
                </pre>
            </div>
        </section>

        <!-- Node Versions -->
        <section class="section">
            <h2 class="section-title">Node Versions (Current)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Workflow</th>
                        <th>Node</th>
                        <th>Version</th>
                        <th>Last Updated</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Build Notes Trigger</td><td>Prepare Agent Prompt</td><td>v7.0</td><td>Feb 13, 2026</td></tr>
                    <tr><td>Build Notes Trigger</td><td>Process Response</td><td>v1.3</td><td>Feb 13, 2026</td></tr>
                    <tr><td>Build Notes Trigger</td><td>Search Images</td><td>v5.3</td><td>Feb 12, 2026</td></tr>
                    <tr><td>Build Notes Trigger</td><td>Upload Images to GHL</td><td>v2.1</td><td>Feb 12, 2026</td></tr>
                    <tr><td>Build Notes Trigger</td><td>Update GHL Values</td><td>v2.8</td><td>Feb 13, 2026</td></tr>
                    <tr><td>Build Notes Trigger</td><td>Update Baserow Generated</td><td>v1.4</td><td>Feb 12, 2026</td></tr>
                    <tr><td>Build Notes Trigger</td><td>Send Ideogram Email</td><td>v2.4</td><td>Feb 13, 2026</td></tr>
                    <tr><td>Build Notes Trigger</td><td>Call OpenClaw Agent</td><td>+max_tokens</td><td>Feb 13, 2026</td></tr>
                </tbody>
            </table>
        </section>

        <!-- Recent Fixes -->
        <section class="section">
            <h2 class="section-title">Recent Fixes (Feb 13, 2026)</h2>

            <div class="card">
                <div class="card-title">1. Email Empty/Wrong Data <span class="badge badge-fixed">FIXED v2.4</span></div>
                <p><strong>Problem:</strong> Email showed "Unknown Company", Services (0), empty AI observations</p>
                <p><strong>Root Cause:</strong> Reading from wrong nodes, wrong field names</p>
                <p><strong>Fix:</strong></p>
                <ul>
                    <li>Read from <code>Process Response</code> (not raw OpenClaw output)</li>
                    <li>Parse <code>form_data</code> JSON string from Baserow</li>
                    <li>Use <code>business_name</code> (not <code>company_name</code>)</li>
                    <li>Email now shows: company info, services list, areas list, AI observations, Ideogram prompt</li>
                </ul>
            </div>

            <div class="card">
                <div class="card-title">2. JSON Parse Failures <span class="badge badge-fixed">FIXED v1.3</span></div>
                <p><strong>Problem:</strong> AI output had malformed JSON with extra <code>}}</code></p>
                <p><strong>Root Cause:</strong> AI sometimes outputs <code>}}</code> at end of JSON</p>
                <p><strong>Fix:</strong> Added brace balancing and markdown fence removal in Process Response</p>
            </div>

            <div class="card">
                <div class="card-title">3. Hero Image Not Updating <span class="badge badge-fixed">FIXED v2.8</span></div>
                <p><strong>Problem:</strong> <code>hero_image_url</code> had OLD value while <code>hero_image_option_1</code> was updated</p>
                <p><strong>Root Cause:</strong> Duplicate MinIO URLs in url_mapping causing key collision</p>
                <p><strong>Fix:</strong> Added sync at start of Update GHL Values:</p>
                <div class="code-block">
                    <code>images.hero_image_url = images.hero_image_option_1;
images.reviews_background_image_url = images.reviews_bg_option_1;
images.quote_background_image_url = images.quote_bg_option_1;</code>
                </div>
            </div>

            <div class="card">
                <div class="card-title">4. OpenClaw Rate Limit <span class="badge badge-fixed">FIXED</span></div>
                <p><strong>Problem:</strong> "all profiles unavailable" error despite $10 balance</p>
                <p><strong>Root Cause:</strong> Billing cooldown cached in auth-profiles.json</p>
                <p><strong>Fix:</strong> Cleared <code>usageStats</code> in auth-profiles.json, restarted service</p>
            </div>

            <div class="card">
                <div class="card-title">5. OpenClaw Token Limit Added</div>
                <p><strong>Problem:</strong> No max_tokens set = unlimited costs</p>
                <p><strong>Fix:</strong> Added <code>max_tokens: 8000</code> to Call OpenClaw Agent</p>
            </div>
        </section>

        <!-- Integration Tests -->
        <section class="section">
            <h2 class="section-title">Integration Tests (E2E)</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Scenario</th>
                        <th>Steps</th>
                        <th>Expected</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>INT-01</td>
                        <td>Happy path - Painter</td>
                        <td>Submit onboarding (painter, 6 services, 8 areas) -> Submit build notes -> Check GHL</td>
                        <td>All values populated, HTTPS images</td>
                        <td><span class="badge badge-passed">PASSED (18063)</span></td>
                    </tr>
                    <tr>
                        <td>INT-02</td>
                        <td>Happy path - Electrician</td>
                        <td>Same as INT-01 with electrician</td>
                        <td>Blue color scheme</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>INT-03</td>
                        <td>Minimal data</td>
                        <td>Only required fields</td>
                        <td>Content with defaults</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>INT-04</td>
                        <td>No website</td>
                        <td>No existing_website_url</td>
                        <td>Generate without scrape</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>INT-05</td>
                        <td>3 services only</td>
                        <td>Submit with 3 services</td>
                        <td>Services 4-12 = [UNUSED]</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>INT-06</td>
                        <td>20 areas</td>
                        <td>Submit with 20 areas</td>
                        <td>Only first 14 used</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>INT-07</td>
                        <td>Re-generation</td>
                        <td>Generate twice same location</td>
                        <td>Second overwrites first</td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>INT-08</td>
                        <td>Color override</td>
                        <td>Painter + "blue" preference</td>
                        <td>ai_observations explains</td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </section>

        <!-- Modular Tests -->
        <section class="section">
            <h2 class="section-title">Modular Tests (Individual Nodes)</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Node</th>
                        <th>Test</th>
                        <th>Input</th>
                        <th>Expected</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>M01</td><td>Parse Form Data</td><td>Valid form</td><td>GHL form JSON</td><td>All fields extracted</td></tr>
                    <tr><td>M02</td><td>Parse Form Data</td><td>Missing fields</td><td>Partial JSON</td><td>Graceful handling</td></tr>
                    <tr><td>M03</td><td>Log to Baserow</td><td>Create row</td><td>Form data</td><td>Row ID returned</td></tr>
                    <tr><td>M04</td><td>Scrape Client Website</td><td>Valid URL</td><td>https://...</td><td>Content + images</td></tr>
                    <tr><td>M05</td><td>Scrape Client Website</td><td>No URL</td><td>Empty</td><td>Skip gracefully</td></tr>
                    <tr><td>M06</td><td>Scrape Client Website</td><td>Blocked site</td><td>URL</td><td>Timeout/error handled</td></tr>
                    <tr><td>M09</td><td>Call OpenClaw</td><td>Valid prompt</td><td>Prompt string</td><td>JSON content</td></tr>
                    <tr><td>M10</td><td>Process Response</td><td>Valid JSON</td><td>AI response</td><td>Parsed content</td></tr>
                    <tr><td>M11</td><td>Process Response</td><td>Invalid JSON</td><td>Malformed</td><td>Error recovery v1.3</td></tr>
                    <tr><td>M12</td><td>Search Images</td><td>Known trade</td><td>"painter"</td><td>96+ images</td></tr>
                    <tr><td>M13</td><td>Search Images</td><td>Unknown trade</td><td>"xyz"</td><td>general_contractor fallback</td></tr>
                    <tr><td>M15</td><td>Upload Images</td><td>Valid URLs</td><td>HTTP URLs</td><td>HTTPS URLs returned</td></tr>
                    <tr><td>M16</td><td>Upload Images</td><td>Invalid URL</td><td>404 URL</td><td>Skip + continue</td></tr>
                    <tr><td>M17</td><td>Update GHL Values</td><td>Full content</td><td>270+ values</td><td>All updated</td></tr>
                </tbody>
            </table>
        </section>

        <!-- Content Quality Tests -->
        <section class="section">
            <h2 class="section-title">Content Quality Tests</h2>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Test</th>
                        <th>Check</th>
                        <th>Expected</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Q01</td><td>Service names</td><td>Case format</td><td>Title Case (not UPPERCASE)</td></tr>
                    <tr><td>Q02</td><td>Area names</td><td>Case format</td><td>Title Case</td></tr>
                    <tr><td>Q03</td><td>Service descriptions</td><td>Length</td><td>Max 20 words, 2 sentences</td></tr>
                    <tr><td>Q04</td><td>Blog titles</td><td>Format</td><td>Title Case, SEO-friendly</td></tr>
                    <tr><td>Q05</td><td>Blog descriptions</td><td>Length</td><td>~50 words</td></tr>
                    <tr><td>Q06</td><td>Blog content</td><td>Structure</td><td>Intro + 3 benefits + Conclusion</td></tr>
                    <tr><td>Q07</td><td>Operating hours</td><td>Parse</td><td>7 separate day values</td></tr>
                    <tr><td>Q08</td><td>FAQ answers</td><td>Quality</td><td>Relevant to trade</td></tr>
                    <tr><td>Q09</td><td>Hero images</td><td>Quality</td><td>hero_suitable=true only</td></tr>
                    <tr><td>Q10</td><td>Image duplicates</td><td>Check</td><td>No duplicate URLs</td></tr>
                </tbody>
            </table>
        </section>

        <!-- Custom Values Count -->
        <section class="section">
            <h2 class="section-title">Custom Values Count (~268 Total)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Count</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>Company Info</td><td>9</td><td>name, owner, email, hours, phones, etc.</td></tr>
                    <tr><td>Colors</td><td>2</td><td>primary, secondary</td></tr>
                    <tr><td>Links</td><td>5</td><td>social, GMB</td></tr>
                    <tr><td>Marketing</td><td>4</td><td>broad_service, headline, about, discount</td></tr>
                    <tr><td>Hero</td><td>2</td><td>description, image</td></tr>
                    <tr><td>Stats</td><td>8</td><td>4 numbers + 4 labels</td></tr>
                    <tr><td>FAQ</td><td>4</td><td>answers 1-4</td></tr>
                    <tr><td>Operating Hours</td><td>7</td><td>sun-sat</td></tr>
                    <tr><td>Blog</td><td>18</td><td>6 x (title + description + content)</td></tr>
                    <tr><td>Services</td><td>24</td><td>12 x (name + description)</td></tr>
                    <tr><td>Service Pages</td><td>36</td><td>12 x (what_is + when_necessary + what_required)</td></tr>
                    <tr><td>Service Images</td><td>48</td><td>12 x (image + backup + hero + hero_backup)</td></tr>
                    <tr><td>Areas</td><td>14</td><td>names</td></tr>
                    <tr><td>Area Pages</td><td>42</td><td>14 x (our_story + services_offered + why_choose_us)</td></tr>
                    <tr><td>Gallery</td><td>29</td><td>24 images + 5 backups</td></tr>
                    <tr><td>Hero Options</td><td>11</td><td>5 hero + 3 reviews + 3 quote</td></tr>
                </tbody>
            </table>
        </section>

        <!-- Last Execution -->
        <section class="section">
            <h2 class="section-title">Last Successful Execution</h2>
            <div class="card">
                <div class="card-title">Execution 18063 (Feb 13, 2026 22:19 UTC)</div>
                <ul>
                    <li><strong>Status:</strong> SUCCESS</li>
                    <li><strong>Duration:</strong> 259.7s (~4.3 min)</li>
                    <li><strong>Content:</strong> 182 text values updated</li>
                    <li><strong>Images:</strong> 49 images uploaded (73 processed, some duplicates)</li>
                    <li><strong>Total:</strong> 231 GHL values updated</li>
                    <li><strong>Email:</strong> Sent successfully via Resend</li>
                </ul>
            </div>
        </section>

        <!-- Webhook URLs -->
        <section class="section">
            <h2 class="section-title">Webhook URLs for Testing</h2>
            <div class="card">
                <div class="card-title">Content Generator (Workflow 1)</div>
                <div class="code-block"><code>POST https://n8n.slatesystems.io/webhook/content-generator</code></div>
            </div>
            <div class="card">
                <div class="card-title">Build Notes Trigger (Workflow 2)</div>
                <div class="code-block"><code>POST https://n8n.slatesystems.io/webhook/build-notes</code></div>
            </div>
        </section>

        <!-- Recovery Notes -->
        <section class="section">
            <h2 class="section-title">Recovery Notes</h2>
            <div class="card">
                <p>If context compacts:</p>
                <ol>
                    <li>Read this file for test plan</li>
                    <li>Main workflow: Build Notes Trigger (<code>4BaNEGdjuP5EsLUy</code>)</li>
                    <li>Carlsbad Location ID: <code>eGWfd8H3OfMWqLENVKzW</code></li>
                    <li>Baserow tables: 946 (content), 947 (images), 948 (build notes), 949 (test tracking)</li>
                    <li>Email: WORKING via Resend (content@updates.slatesystems.io -> slatesystemsgmb@gmail.com)</li>
                    <li>Area hero URLs: DELETED (14 values removed from GHL)</li>
                    <li>OpenClaw server: 178.156.233.54, API key in auth-profiles.json</li>
                </ol>
            </div>
        </section>

    </main>

    <footer>
        Â© 2026 Slate Systems Inc. Internal use only.
    </footer>
</body>
</html>
